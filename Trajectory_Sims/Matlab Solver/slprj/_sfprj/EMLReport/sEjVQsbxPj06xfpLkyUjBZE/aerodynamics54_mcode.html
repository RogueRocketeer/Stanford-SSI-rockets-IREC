<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="34,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">% Aerodynamics</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Defines the aerodynamic forces acting on the rocket</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% Ian Gomez, Rushal Rege 04/11/2017</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,5" id="srcline5"> 5</a></span><span class="line"><span class="keyword">function</span> [<span class="var type0" id="S2T0U3">Fdrag</span>, <span class="var type0" id="S3T0U4">Flift</span>] = aerodynamics(<span class="var type1" id="S4T17U7">r</span>, <span class="var type1" id="S5T17U8">u</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="34,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% rev 0 = simple drag model (1/2 rho CD v^2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% rev 1 = use CD table from RASAero </span></span></span>
<span class="srcline"><span class="lineno"><a href="34,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% rev 2 = use OpenRocket subsonic drag and call RASAero drag past transonic</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,10" id="srcline10">10</a></span><span class="line"><span class="comment">% find angle of attack; vector addition of axial velocity and wind </span></span></span>
<span class="srcline"><span class="lineno"><a href="34,11" id="srcline11">11</a></span><span class="line"><span class="comment">% for constant case</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,14" id="srcline14">14</a></span><span class="line"><span class="comment">% Calculate atmosphere </span></span></span>
<span class="srcline"><span class="lineno"><a href="34,15" id="srcline15">15</a></span><span class="line">[<span class="mxinfo " id="T2:U3">~</span>,<span class="mxinfo " id="T2:U4">~</span>,<span class="var type1" id="S6T2U14">rho</span>,<span class="var type1" id="S7T2U15">local_c</span>] = <span class="fcn" id="F55N6:B17">getAtmoConditions</span>(<span class="mxinfo " id="T2:U7"><span class="var type1" id="S4T17U19">r</span>(<span class="mxinfo " id="T6:U9">2</span>)</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="34,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T2:U10"><span class="var type1" id="S9T2U23">mach</span> = <span class="mxinfo " id="T2:U12"><span class="mxinfo " id="T2:U13">norm(<span class="mxinfo " id="T25:U14"><span class="var type1" id="S5T17U28">u</span>(1:2)</span>)</span>/<span class="var type1" id="S7T2U32">local_c</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="34,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,19" id="srcline19">19</a></span><span class="line"><span class="comment">% Check for mach number; </span></span></span>
<span class="srcline"><span class="lineno"><a href="34,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T2:U17"><span class="var type1" id="S11T2U35">k</span> = <span class="mxinfo " id="T2:U19">1</span></span>; <span class="mxinfo " id="T2:U20"><span class="var type1" id="S12T2U39">tol</span> = <span class="mxinfo " id="T2:U22">0.01</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="34,21" id="srcline21">21</a></span><span class="line"><span class="keyword">while</span>(abs(<span class="var type1" id="S9T2U47">mach</span>-<span class="message error" id="M14F54C">aerodata(<span class="var type1" id="S11T2U50">k</span>,<span class="mxinfo " id="T2:U25">1</span>)</span>) &gt; <span class="var type0" id="S12T0U52">tol</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="34,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T2:U26"><span class="var type1" id="S11T2U55">k</span> = <span class="mxinfo " id="T2:U28"><span class="var type1" id="S11T2U57">k</span> + <span class="mxinfo " id="T2:U30">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="34,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,25" id="srcline25">25</a></span><span class="line"><span class="comment">% Compare angle of attack and use weighted average</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,26" id="srcline26">26</a></span><span class="line"><span class="comment">% aerodata = [RASMa, CD0, CD2, CD4, CL0, CL2, CL4];</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,27" id="srcline27">27</a></span><span class="line"><span class="keyword">if</span> abs(<span class="message error" id="M15F54C">aoa</span>) &lt;= 2</span></span>
<span class="srcline"><span class="lineno"><a href="34,28" id="srcline28">28</a></span><span class="line">    <span class="var type0" id="S16T0U69">weight</span> = <span class="message error" id="M16F54C">aoa</span>/2;</span></span>
<span class="srcline"><span class="lineno"><a href="34,29" id="srcline29">29</a></span><span class="line">    <span class="var type0" id="S17T0U76">CD</span> = <span class="var type0" id="S16T0U79"><span class="message error" id="M17F54C">weight</span></span> * aerodata(<span class="var type0" id="S11T0U82">k</span>,3) + (1-<span class="var type0" id="S16T0U88">weight</span>) * aerodata(<span class="var type0" id="S11T0U91">k</span>,2);</span></span>
<span class="srcline"><span class="lineno"><a href="34,30" id="srcline30">30</a></span><span class="line">    <span class="var type0" id="S18T0U95">CL</span> = <span class="var type0" id="S16T0U98"><span class="message error" id="M18F54C">weight</span></span> * aerodata(<span class="var type0" id="S11T0U101">k</span>,6) + (1-<span class="var type0" id="S16T0U107">weight</span>) * aerodata(<span class="var type0" id="S11T0U110">k</span>,5);</span></span>
<span class="srcline"><span class="lineno"><a href="34,31" id="srcline31">31</a></span><span class="line"><span class="keyword">elseif</span> abs(<span class="message error" id="M19F54C">aoa</span>) &lt;= 4</span></span>
<span class="srcline"><span class="lineno"><a href="34,32" id="srcline32">32</a></span><span class="line">    <span class="var type0" id="S16T0U121">weight</span> = (<span class="message error" id="M20F54C">aoa</span>-2)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="34,33" id="srcline33">33</a></span><span class="line">    <span class="var type0" id="S17T0U131">CD</span> = <span class="var type0" id="S16T0U134"><span class="message error" id="M21F54C">weight</span></span> * aerodata(<span class="var type0" id="S11T0U137">k</span>,4) + (1-<span class="var type0" id="S16T0U143">weight</span>) * aerodata(<span class="var type0" id="S11T0U146">k</span>,3);</span></span>
<span class="srcline"><span class="lineno"><a href="34,34" id="srcline34">34</a></span><span class="line">    <span class="var type0" id="S18T0U150">CL</span> = <span class="var type0" id="S16T0U153"><span class="message error" id="M22F54C">weight</span></span> * aerodata(<span class="var type0" id="S11T0U156">k</span>,7) + (1-<span class="var type0" id="S16T0U162">weight</span>) * aerodata(<span class="var type0" id="S11T0U165">k</span>,6);</span></span>
<span class="srcline"><span class="lineno"><a href="34,35" id="srcline35">35</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,36" id="srcline36">36</a></span><span class="line">    <span class="autoExtrinsicFcn" id="F83N3:B170">disp</span>(<span class="string">'yo, aoa &gt; 4'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="34,37" id="srcline37">37</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,39" id="srcline39">39</a></span><span class="line"><span class="var type0" id="S20T0U174">S</span> = <span class="mxinfo " id="T2:U31">pi</span> .* (<span class="message error" id="M23F54C">rocket</span>.OD.^2)./4; <span class="comment">% axial surface area</span></span></span>
<span class="srcline"><span class="lineno"><a href="34,40" id="srcline40">40</a></span><span class="line"><span class="var type0" id="S2T0U188">Fdrag</span> = <span class="var type0" id="S17T0U193"><span class="message error" id="M24F54C">CD</span></span> .* <span class="var type0" id="S20T0U194">S</span> .* 0.5 .* <span class="var type0" id="S6T0U196">rho</span> .* (cosd(aoa) .* norm(<span class="var type0" id="S5T0U207">u</span>(1:2))).^2; </span></span>
<span class="srcline"><span class="lineno"><a href="34,41" id="srcline41">41</a></span><span class="line"><span class="var type0" id="S3T0U214">Flift</span> = <span class="var type0" id="S18T0U219"><span class="message error" id="M25F54C">CL</span></span> .* <span class="var type0" id="S20T0U220">S</span> .* 0.5 .* <span class="var type0" id="S6T0U222">rho</span> .* (sind(aoa) .* norm(<span class="var type0" id="S5T0U233">u</span>(1:2))).^2; </span></span>
<span class="srcline"><span class="lineno"><a href="34,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="34,43" id="srcline43">43</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
